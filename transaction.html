<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Checkout - Cy Salon</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<link rel="stylesheet" href="fonts.css">
	</head>
	<body class="font-rubik bg-gray-50">
		<header class="relative bg-[url('https://images.pexels.com/photos/1319460/pexels-photo-1319460.jpeg')] bg-center bg-cover">
			<div class="absolute inset-0 bg-black/40 pointer-events-none"></div>
			<nav class="relative w-full text-white p-6 md:flex block items-center justify-between" x-data="{open: false}">
				<div class="flex items-center justify-between md:w-auto w-full">
					<h4 class="text-xl">Cy Salon</h4>
					<button class="border p-2 rounded md:hidden block border-gray-500" @click="open = !open" aria-label="Toggle menu">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5">
							<path fill-rule="evenodd" d="M2 4.75A.75.75 0 0 1 2.75 4h14.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 4.75ZM2 10a.75.75 0 0 1 .75-.75h14.5a.75.75 0 0 1 0 1.5H2.75A.75.75 0 0 1 2 10Zm0 5.25a.75.75 0 0 1 .75-.75h14.5a.75.75 0 0 1 0 1.5H2.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd" />
						</svg>
					</button>
				</div>
				<ul class="md:flex md:items-center md:space-x-4 md:mt-0 mt-4 md:space-y-0 space-y-2" :class="{'hidden': !open}">
					<li>
						<a href="index.html">Home</a>
					</li>
					<li>
						<a href="aboutUs.html">About Us</a>
					</li>
					<li>
						<a href="services.html">Services</a>
					</li>
					<li>
						<a href="customerService.html">Customer Care</a>
					</li>
					<li>
						<a href="booking.html">Book Now</a>
					</li>
				</ul>
			</nav>
			<div class="relative py-24 text-center text-white">
				<h1 class="text-6xl font-bold">Booking Summary</h1>
			</div>
		</header>
		<main class="max-w-7xl mx-auto p-6 my-16 space-y-8">
			<h4 class="text-2xl font-medium">Your Cart</h4>
			<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
				<!-- Cart + Voucher -->
				<div class="md:col-span-2 space-y-4">
					<div class="bg-white p-4 rounded shadow pb-4">
						<div class="flex justify-between items-center mb-4">
							<h2 class="text-xl font-bold">Cart <span id="cart-count" class="text-gray-500 font-normal"></span>
							</h2>
							<button id="clear" class="text-red-600 text-sm hover:underline">Clear cart</button>
						</div>
						<div id="cart"></div>
					</div>
					<!-- Voucher -->
					<div class="space-y-3">
						<div class="flex items-center gap-3">
							<input type="text" id="voucher_code" placeholder="Enter voucher code" class="border rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-zinc-600" />
							<button id="apply-voucher" class="bg-zinc-800 text-white hover:bg-zinc-900 ease duration-200 px-4 py-2 rounded"> Apply Voucher </button>
						</div>
						<p id="voucher_feedback" class="text-sm"></p>
						<div id="active_voucher" class="hidden text-sm text-green-700 bg-green-50 border border-green-200 rounded px-3 py-2">
							<span id="active_voucher_text"></span>
							<button id="remove-voucher" class="ml-3 text-green-700 underline hover:no-underline">Remove</button>
						</div>
					</div>
				</div>
				<!-- Summary -->
				<div class="space-y-8">
					<div class="bg-white p-4 rounded shadow space-y-4">
						<h3 class="text-lg font-bold">Booking Information</h3>
						<div>
							<label for="name" class="text-sm font-medium text-gray-600">Full Name</label>
							<input type="text" id="name" class="w-full border rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-zinc-600" required>
						</div>
						<div>
							<label for="email" class="text-sm font-medium text-gray-600">Email</label>
							<input type="email" id="email" class="w-full border rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-zinc-600" required>
						</div>
						<div>
							<label for="date" class="text-sm font-medium text-gray-600">Date</label>
							<input type="date" id="date" class="w-full border rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-zinc-600" required>
						</div>
						<div>
							<label for="time" class="text-sm font-medium text-gray-600">Time</label>
							<select id="time" class="w-full border rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-zinc-600" required>
								<option value="09-10">9:00AM - 10:00AM</option>
								<option value="10-11">10:00AM - 11:00AM</option>
								<option value="11-12">11:00AM - 12:00PM</option>
								<option value="12-13">12:00PM - 1:00PM</option>
								<option value="13-14">1:00PM - 2:00PM</option>
								<option value="14-15">2:00PM - 3:00PM</option>
								<option value="15-16">3:00PM - 4:00PM</option>
								<option value="16-17">4:00PM - 5:00PM</option>
							</select>
						</div>
					</div>
					<div class="bg-white p-4 rounded shadow space-y-3">
						<h3 class="text-lg font-bold">Summary</h3>
						<div class="flex justify-between">
							<span>Subtotal</span>
							<span id="subtotal">₱0.00</span>
						</div>
						<!-- Discount Row (hidden until applied) -->
						<div id="discount-row" class="flex justify-between text-green-700 hidden">
							<span id="discountLabel">Discount</span>
							<span id="discountAmount">-₱0.00</span>
						</div>
						<div class="flex justify-between font-bold text-lg border-t pt-2">
							<span>Total</span>
							<span id="total">₱0.00</span>
						</div>
						<div class="mt-2 flex justify-center">
							<a href="#" class="w-full bg-zinc-800 text-white hover:bg-zinc-900 ease duration-200 text-center py-2 rounded"> Book Now </a>
						</div>
					</div>
				</div>
			</div>
		</main>
		<script>
			const vouchers = [{
					code: "SHAVE20",
					discount: "20"
				},
			];
			const peso = new Intl.NumberFormat('en-PH', {
				style: 'currency',
				currency: 'PHP',
				minimumFractionDigits: 2,
				maximumFractionDigits: 2,
			});

			function formatPHP(n) {
				const num = typeof n === 'number' ? n : Number(n || 0);
				return peso.format(num);
			}

			function parseStored(key, fallback = null) {
				try {
					return JSON.parse(localStorage.getItem(key) || 'null') ?? fallback;
				} catch {
					return fallback;
				}
			}

			function loadCart() {
				let cart = [];
				const savedCart = parseStored('cart');
				if (Array.isArray(savedCart) && savedCart.length) {
					cart = savedCart;
				} else {
					const selected = parseStored('selectedProduct');
					if (selected && typeof selected === 'object') {
						const normalized = {
							id: Number(selected.id),
							name: String(selected.name || 'Selected Item'),
							price: Number(selected.price) || 0,
							qty: Number(selected.qty) || 1,
						};
						cart = [normalized];
						localStorage.setItem('cart', JSON.stringify(cart));
					}
				}
				return cart;
			}

			function saveCart(cart) {
				localStorage.setItem('cart', JSON.stringify(cart));
			}

			function normalizeCode(s) {
				return String(s || '').trim().toUpperCase();
			}

			function findVoucher(inputCode) {
				const code = normalizeCode(inputCode);
				return vouchers.find(v => normalizeCode(v.code) === code) || null;
			}
			let cart = loadCart();
			let appliedVoucher = parseStored('appliedVoucher'); 
			const cartDiv = document.getElementById("cart");
			const subtotalEl = document.getElementById("subtotal");
			const totalEl = document.getElementById("total");
			const countEl = document.getElementById("cart-count");
			const voucherInput = document.getElementById('voucher_code');
			const applyVoucherBtn = document.getElementById('apply-voucher');
			const voucherFeedback = document.getElementById('voucher_feedback');
			const activeVoucherBox = document.getElementById('active_voucher');
			const activeVoucherTxt = document.getElementById('active_voucher_text');
			const removeVoucherBtn = document.getElementById('remove-voucher');
			const discountRow = document.getElementById('discount-row');
			const discountLabel = document.getElementById('discountLabel');
			const discountAmountEl = document.getElementById('discountAmount');

			function computeSubtotal() {
				return cart.reduce((sum, item) => {
					const line = (Number(item.price) || 0) * (Number(item.qty) || 0);
					return sum + line;
				}, 0);
			}

			function computeDiscount(subtotal) {
				if (!appliedVoucher) return 0;
				const pct = Number(appliedVoucher.discount) || 0;
				return Math.max(0, subtotal * (pct / 100));
			}

			function computeTotals() {
				const subtotal = computeSubtotal();
				const discount = computeDiscount(subtotal);
				const total = Math.max(0, subtotal - discount);
				return {
					subtotal,
					discount,
					total
				};
			}

			function renderVoucherUI(subtotal) {
				voucherFeedback.textContent = '';
				voucherFeedback.className = 'text-sm';
				if (appliedVoucher) {
					const pct = Number(appliedVoucher.discount) || 0;
					activeVoucherTxt.textContent = `Applied voucher: ${appliedVoucher.code} (${pct}% off)`;
					activeVoucherBox.classList.remove('hidden');
					const discount = computeDiscount(subtotal);
					discountLabel.textContent = `Discount (${appliedVoucher.code} - ${pct}%)`;
					discountAmountEl.textContent = '-' + formatPHP(discount);
					discountRow.classList.remove('hidden');
					voucherInput.value = appliedVoucher.code;
					voucherInput.disabled = true;
					applyVoucherBtn.disabled = true;
					applyVoucherBtn.classList.add('opacity-60', 'cursor-not-allowed');
				} else {
					activeVoucherBox.classList.add('hidden');
					discountRow.classList.add('hidden');
					voucherInput.disabled = false;
					applyVoucherBtn.disabled = false;
					applyVoucherBtn.classList.remove('opacity-60', 'cursor-not-allowed');
				}
			}

			function renderCart() {
				cartDiv.innerHTML = "";
				let totalQty = 0;
				if (!cart.length) {
					cartDiv.innerHTML = `
          
							<div class="py-6 text-center text-gray-500">Your cart is empty.</div>
        `;
					subtotalEl.textContent = formatPHP(0);
					totalEl.textContent = formatPHP(0);
					countEl.textContent = `(0 items)`;
					saveCart(cart);
					localStorage.removeItem('selectedProduct');
					appliedVoucher = null;
					localStorage.removeItem('appliedVoucher');
					renderVoucherUI(0);
					return;
				}
				cart.forEach(item => {
					const lineTotal = (Number(item.price) || 0) * (Number(item.qty) || 0);
					totalQty += Number(item.qty) || 0;
					cartDiv.innerHTML += `
          
							<div class="flex justify-between items-center py-2 border-b">
								<div>
									<p class="font-semibold">${item.name}</p>
									<p class="text-sm text-gray-500">${formatPHP(item.price)}</p>
								</div>
								<div class="flex items-center space-x-2">
									<button onclick="updateQty(${item.id}, -1)" class="px-2 border rounded">-</button>
									<span>${item.qty}</span>
									<button onclick="updateQty(${item.id}, 1)" class="px-2 border rounded">+</button>
									<span class="font-bold min-w-28 text-right">${formatPHP(lineTotal)}</span>
									<button onclick="removeItem(${item.id})" class="text-red-600 hover:underline" title="Remove">✕</button>
								</div>
							</div>
        `;
				});
				const {
					subtotal,
					discount,
					total
				} = computeTotals();
				subtotalEl.textContent = formatPHP(subtotal);
				totalEl.textContent = formatPHP(total);
				countEl.textContent = `(${totalQty} ${totalQty === 1 ? 'item' : 'items'})`;
				renderVoucherUI(subtotal);
				saveCart(cart);
			}
			window.updateQty = function(id, change) {
				const idx = cart.findIndex(i => Number(i.id) === Number(id));
				if (idx === -1) return;
				const next = Math.max(1, Number(cart[idx].qty) + Number(change));
				cart[idx].qty = next;
				renderCart();
			};
			window.removeItem = function(id) {
				cart = cart.filter(i => Number(i.id) !== Number(id));
				renderCart();
			};
			document.getElementById("clear").addEventListener("click", () => {
				cart = [];
				saveCart(cart);
				localStorage.removeItem('selectedProduct');
				appliedVoucher = null;
				localStorage.removeItem('appliedVoucher');
				renderCart();
			});
			applyVoucherBtn.addEventListener('click', () => {
				const code = normalizeCode(voucherInput.value);
				if (!code) {
					voucherFeedback.textContent = 'Please enter a voucher code.';
					voucherFeedback.classList.add('text-red-600');
					return;
				}
				const match = findVoucher(code);
				if (!match) {
					voucherFeedback.textContent = 'Invalid voucher code.';
					voucherFeedback.classList.add('text-red-600');
					return;
				}
				appliedVoucher = {
					code: match.code,
					discount: match.discount
				};
				localStorage.setItem('appliedVoucher', JSON.stringify(appliedVoucher));
				voucherFeedback.textContent = 'Voucher applied!';
				voucherFeedback.classList.remove('text-red-600');
				voucherFeedback.classList.add('text-green-700');
				renderCart();
			});
			removeVoucherBtn.addEventListener('click', (e) => {
				e.preventDefault();
				appliedVoucher = null;
				localStorage.removeItem('appliedVoucher');
				voucherFeedback.textContent = 'Voucher removed.';
				voucherFeedback.classList.remove('text-red-600');
				voucherFeedback.classList.add('text-gray-600');
				voucherInput.value = '';
				renderCart();
			});
			renderCart();
		</script>
	</body>
</html>